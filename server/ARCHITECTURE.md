# Server Architecture

This project follows **Clean Architecture** principles and the **Standard Go Project Layout**.

## Directory Structure

```
server/
├── cmd/
│   └── api/
│       └── main.go           # Entry point. Initializes config, db, server, and starts app.
├── internal/
│   ├── api/                  # HTTP Layer
│   │   ├── handler/          # HTTP Handlers (Requests/Responses)
│   │   │   ├── url.go        # URL Shortening & Redirect endpoints
│   │   │   └── qr.go         # QR Code generation endpoint
│   │   ├── middleware/       # Custom middleware (RateLimit, logging, etc.)
│   │   ├── router.go         # Router definitions (endpoints -> handlers mapping)
│   │   └── server.go         # Server struct and dependency injection
│   ├── service/              # Business Logic Layer
│   │   ├── url_service.go    # Logic for hashing, shortening, database interaction
│   │   └── qr_service.go     # Logic for QR generation, image processing, gradients
│   ├── utils/                # Shared Utilities
│   │   ├── image.go          # Image processing helpers (resize, border radius)
│   │   └── validator.go      # Input validation (e.g., SSRF checks)
│   ├── db/                   # Database Access (generated by sqlc)
│   └── config/               # Configuration loader
└── pkg/                      # Public libraries (if any)
```

## Layers

1.  **Handler Layer (`internal/api/handler`)**:
    - Parses HTTP requests (JSON body, Query params).
    - Validates input format (basic checks).
    - Calls **Service Layer**.
    - Formats HTTP responses (JSON, status codes).
    - _Should not contain complex business logic or SQL queries._

2.  **Service Layer (`internal/service`)**:
    - Contains the core business logic.
    - Interacts with **Database** or external APIs.
    - Reusable validation rules.
    - _Independent of HTTP (can be used by CLI, gRPC, etc.)._

3.  **Database/Repository (`internal/db`)**:
    - Direct database access using `sqlc`.
    - Executed by Service layer.

4.  **Utils (`internal/utils`)**:
    - Pure functions (stateless) used across layers.
    - Example: Image resizing, string validation.

## Adding a New Feature

1.  **Database**: Add/Update schema in `schema.sql` and run `task sqlc` (if needing new tables/queries).
2.  **Service**: Create a new service or add method to existing service in `internal/service/` to handle the logic.
3.  **Handler**: Create a new handler in `internal/api/handler/` that calls the service.
4.  **Route**: Register the new handler in `internal/api/router.go`.
